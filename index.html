<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Enlaces Educativos | Geolocalizaci√≥n Avanzada üåç</title>
    
    <style>
        /* ==================== */
        /* === ESTILOS CSS === */
        /* ==================== */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --border-radius: 12px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --dark-color: #0f172a;
            --light-color: #1e293b;
            --gradient-primary: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            --gradient-secondary: linear-gradient(135deg, #7e22ce 0%, #c026d3 100%);
            --gradient-accent: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            --glass-bg: rgba(30, 41, 59, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--gradient-primary);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: var(--transition);
        }

        body[data-theme="dark"] {
            color: #e2e8f0;
        }

        header {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            width: 100%;
            padding: 2rem 0;
            text-align: center;
            box-shadow: var(--box-shadow);
            border-bottom: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-accent);
            opacity: 0.05;
            z-index: -1;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        body[data-theme="dark"] .subtitle {
            color: #cbd5e1;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 0.95rem;
            color: #856404;
            margin-top: 10px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        body[data-theme="dark"] .warning {
            background: #fef3c7;
            border-color: #fcd34d;
            color: #92400e;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
            box-shadow: var(--box-shadow-hover);
        }

        main {
            width: 90%;
            max-width: 1200px;
            padding: 2.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 2rem 0;
            flex-grow: 1;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin: 2.5rem 0 1.5rem;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2:first-child {
            margin-top: 0;
        }

        /* Formulario */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body[data-theme="dark"] label {
            color: #e2e8f0;
        }

        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: #fff;
        }

        body[data-theme="dark"] input,
        body[data-theme="dark"] textarea,
        body[data-theme="dark"] select {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--gradient-secondary);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn i {
            font-size: 1.2rem;
        }

        .btn-secondary {
            background: var(--gradient-primary);
        }

        .btn-accent {
            background: var(--gradient-accent);
        }

        /* Lista de Enlaces */
        .links-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-box, .category-filter {
            flex: 1;
            min-width: 200px;
        }

        .link-entry {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .link-entry:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .link-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--gradient-secondary);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-name {
            color: var(--dark-color);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body[data-theme="dark"] .user-name {
            color: #e2e8f0;
        }

        .category-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--primary-color);
            color: white;
        }

        .link-content {
            margin-bottom: 1rem;
        }

        .link-content p {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .link-content a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            word-break: break-all;
            transition: var(--transition);
        }

        .link-content a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        .ip-info {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--accent-color);
        }

        body[data-theme="dark"] .ip-info {
            background: #334155;
        }

        .geo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .geo-card {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            transition: var(--transition);
        }

        body[data-theme="dark"] .geo-card {
            background: #334155;
            border-color: #475569;
        }

        .geo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .geo-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .geo-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        body[data-theme="dark"] .geo-card p {
            color: #e2e8f0;
        }

        .detection-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .detected {
            background: #d4edda;
            color: #155724;
        }

        .not-detected {
            background: #f8d7da;
            color: #721c24;
        }

        .map-container {
            margin-top: 1rem;
            height: 250px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e1e5e9;
            z-index: 1;
        }

        .toggle-details {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 1rem;
            font-weight: 600;
        }

        .toggle-details:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* Contenido ocultable */
        .details-content {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed #e1e5e9;
        }

        .details-content.show {
            display: block;
        }

        .timestamp {
            font-size: 0.85rem;
            color: #6c757d;
            text-align: right;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }

        body[data-theme="dark"] .timestamp {
            color: #94a3b8;
        }

        /* Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--glass-bg);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-secondary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 600;
        }

        body[data-theme="dark"] .stat-label {
            color: #94a3b8;
        }

        footer {
            width: 100%;
            text-align: center;
            padding: 1.5rem;
            background: var(--dark-color);
            color: white;
            margin-top: auto;
        }

        /* Estilos para carga y mensajes */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            font-style: italic;
        }

        .loading:after {
            content: "...";
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            40% { color: #6c757d; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            60% { text-shadow: .25em 0 0 #6c757d, .5em 0 0 rgba(0,0,0,0); }
            80%, 100% { text-shadow: .25em 0 0 #6c757d, .5em 0 0 #6c757d; }
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            display: none;
            border: 1px solid #c3e6cb;
        }

        body[data-theme="dark"] .success-message {
            background: #bbf7d0;
            color: #065f46;
            border-color: #86efac;
        }

        /* Indicador de precisi√≥n (barra) */
        .accuracy-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 10px;
        }

        .accuracy-bar {
            flex-grow: 1;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .accuracy-level {
            height: 100%;
            background: var(--secondary-color);
            border-radius: 3px;
            transition: width 1s ease-in-out;
        }

        /* NUEVOS ESTILOS PARA FUNCIONALIDADES AVANZADAS */
        
        /* Modal de confirmaci√≥n */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        /* Filtros avanzados */
        .advanced-filters {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #e1e5e9;
        }

        body[data-theme="dark"] .advanced-filters {
            background: #334155;
            border-color: #475569;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-row:last-child {
            margin-bottom: 0;
        }
        
        /* Indicador de carga mejorado */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Gr√°fico de estad√≠sticas */
        .chart-container {
            height: 300px;
            margin: 2rem 0;
            position: relative;
        }
        
        /* Navegaci√≥n por pesta√±as */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        body[data-theme="dark"] .tabs {
            border-bottom-color: #475569;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body[data-theme="dark"] .tab {
            color: #cbd5e1;
        }
        
        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Nuevos elementos de UI */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            color: #6c757d;
        }

        body[data-theme="dark"] .action-btn {
            color: #94a3b8;
        }

        .action-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: #f59e0b;
        }

        .rating {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .star {
            color: #d1d5db;
            cursor: pointer;
            transition: var(--transition);
        }

        .star.active, .star:hover {
            color: #f59e0b;
        }

        .export-panel {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border: 1px solid #e1e5e9;
        }

        body[data-theme="dark"] .export-panel {
            background: #334155;
            border-color: #475569;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .admin-panel {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border: 1px solid #e1e5e9;
        }

        body[data-theme="dark"] .admin-panel {
            background: #334155;
            border-color: #475569;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        /* Media Queries para responsividad */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .geo-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .links-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
            
            .modal-buttons {
                flex-direction: column;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                justify-content: center;
            }

            h1 {
                font-size: 2.2rem;
            }
        }

        /* Animaciones adicionales */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js para gr√°ficos avanzados -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </div>
            <h1><i class="fas fa-globe-americas"></i> Plataforma de Recursos Educativos</h1>
            <p class="subtitle">Comparte y descubre enlaces de conocimiento de forma colaborativa</p>
            <div class="warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Advertencia de Seguridad:</strong> Se registra la IP p√∫blica y datos de geolocalizaci√≥n para auditor√≠a y protecci√≥n contra uso indebido. **Sistema de doble-API activo.**
            </div>
        </div>
    </header>

    <main>
        <div class="tabs">
            <div class="tab active" data-tab="share">
                <i class="fas fa-share-alt"></i> Compartir Recurso
            </div>
            <div class="tab" data-tab="resources">
                <i class="fas fa-list"></i> Recursos Compartidos
            </div>
            <div class="tab" data-tab="analytics">
                <i class="fas fa-chart-bar"></i> Estad√≠sticas Avanzadas
            </div>
            <div class="tab" data-tab="admin">
                <i class="fas fa-cog"></i> Panel de Administraci√≥n
            </div>
        </div>
        
        <section id="share" class="tab-content active">
            <h2><i class="fas fa-share-alt"></i> Compartir Nuevo Recurso</h2>
            <div id="success-message" class="success-message">
                <i class="fas fa-check-circle"></i> ¬°Recurso compartido exitosamente! La informaci√≥n de geolocalizaci√≥n ha sido registrada.
            </div>
            <form id="link-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nombre"><i class="fas fa-user"></i> Nombre Completo</label>
                        <input type="text" id="nombre" required placeholder="Ej: Mar√≠a Gonz√°lez L√≥pez" autocomplete="name">
                    </div>
                    <div class="form-group">
                        <label for="categoria"><i class="fas fa-tags"></i> Categor√≠a del Recurso</label>
                        <select id="categoria" required>
                            <option value="">Selecciona una categor√≠a</option>
                            <option value="1">üìö Material de Estudio</option>
                            <option value="2">üé• Video Tutoriales</option>
                            <option value="3">üìù Ejercicios y Pr√°cticas</option>
                            <option value="4">üî¨ Ciencia y Tecnolog√≠a</option>
                            <option value="5">üåê Otros Recursos</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="link-url"><i class="fas fa-link"></i> Enlace del Recurso (URL)</label>
                        <input type="url" id="link-url" required placeholder="https://drive.google.com/... o https://t.me/..." autocomplete="off">
                    </div>
                    <div class="form-group full-width">
                        <label for="descripcion"><i class="fas fa-align-left"></i> Descripci√≥n del Contenido</label>
                        <textarea id="descripcion" placeholder="Describe brevemente el contenido del recurso que est√°s compartiendo..."></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-paper-plane"></i> Compartir Recurso y Registrar Ubicaci√≥n
                </button>
            </form>
        </section>

        <section id="resources" class="tab-content">
            <div class="links-header">
                <h2><i class="fas fa-list"></i> Recursos Compartidos</h2>
                <div class="controls">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Buscar en recursos...">
                    </div>
                    <div class="category-filter">
                        <select id="category-filter">
                            <option value="">Todas las categor√≠as</option>
                            <option value="1">Material de Estudio</option>
                            <option value="2">Video Tutoriales</option>
                            <option value="3">Ejercicios y Pr√°cticas</option>
                            <option value="4">Ciencia y Tecnolog√≠a</option>
                            <option value="5">Otros Recursos</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="advanced-filters">
                <h3><i class="fas fa-filter"></i> Filtros Avanzados</h3>
                <div class="filter-row">
                    <div>
                        <label for="country-filter">Pa√≠s</label>
                        <select id="country-filter">
                            <option value="">Todos los pa√≠ses</option>
                        </select>
                    </div>
                    <div>
                        <label for="date-filter">Fecha</label>
                        <select id="date-filter">
                            <option value="">Cualquier fecha</option>
                            <option value="today">Hoy</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div id="custom-date-range" style="display: none;">
                        <label for="start-date">Desde</label>
                        <input type="date" id="start-date">
                        <label for="end-date">Hasta</label>
                        <input type="date" id="end-date">
                    </div>
                </div>
                <div class="filter-row">
                    <div>
                        <label for="accuracy-filter">Precisi√≥n de Geolocalizaci√≥n</label>
                        <select id="accuracy-filter">
                            <option value="">Cualquier precisi√≥n</option>
                            <option value="high">Alta</option>
                            <option value="medium">Media</option>
                            <option value="low">Baja</option>
                        </select>
                    </div>
                    <div>
                        <label for="sort-by">Ordenar por</label>
                        <select id="sort-by">
                            <option value="newest">M√°s recientes primero</option>
                            <option value="oldest">M√°s antiguos primero</option>
                            <option value="name">Nombre (A-Z)</option>
                            <option value="country">Pa√≠s</option>
                            <option value="rating">Mejor valorados</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <div>
                        <label for="favorites-filter">Mostrar</label>
                        <select id="favorites-filter">
                            <option value="all">Todos los recursos</option>
                            <option value="favorites">Solo favoritos</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <p id="no-links-message" class="loading">Cargando recursos compartidos...</p>
            <div id="links-container"></div>
        </section>

        <section id="analytics" class="tab-content">
            <h2><i class="fas fa-chart-bar"></i> Estad√≠sticas Avanzadas</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-links">0</div>
                    <div class="stat-label">Total de Recursos Compartidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="unique-countries">0</div>
                    <div class="stat-label">Pa√≠ses Colaboradores √önicos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="today-links">0</div>
                    <div class="stat-label">Recursos Compartidos Hoy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="detection-rate">0%</div>
                    <div class="stat-label">Tasa de Geolocalizaci√≥n Precisa</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="category-chart"></canvas>
            </div>
            
            <div class="chart-container">
                <canvas id="country-chart"></canvas>
            </div>
            
            <div class="geo-grid">
                <div class="geo-card">
                    <h4><i class="fas fa-map-marker-alt"></i> Pa√≠s M√°s Activo</h4>
                    <p id="most-active-country">-</p>
                </div>
                <div class="geo-card">
                    <h4><i class="fas fa-clock"></i> Hora Pico de Actividad</h4>
                    <p id="peak-activity-time">-</p>
                </div>
                <div class="geo-card">
                    <h4><i class="fas fa-calendar"></i> D√≠a M√°s Activo</h4>
                    <p id="most-active-day">-</p>
                </div>
                <div class="geo-card">
                    <h4><i class="fas fa-tag"></i> Categor√≠a M√°s Popular</h4>
                    <p id="most-popular-category">-</p>
                </div>
            </div>

            <div class="export-panel">
                <h3><i class="fas fa-download"></i> Exportar Datos</h3>
                <p>Descarga los datos de recursos educativos en diferentes formatos:</p>
                <div class="export-options">
                    <button class="btn btn-secondary" id="export-json">
                        <i class="fas fa-file-code"></i> Exportar JSON
                    </button>
                    <button class="btn btn-secondary" id="export-csv">
                        <i class="fas fa-file-csv"></i> Exportar CSV
                    </button>
                    <button class="btn btn-secondary" id="export-pdf">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                </div>
            </div>
        </section>

        <section id="admin" class="tab-content">
            <h2><i class="fas fa-cog"></i> Panel de Administraci√≥n</h2>
            
            <div class="admin-panel">
                <h3><i class="fas fa-tools"></i> Herramientas de Administraci√≥n</h3>
                <p>Gestiona los recursos compartidos y configura el sistema:</p>
                
                <div class="admin-controls">
                    <button class="btn btn-danger" id="clear-all-data">
                        <i class="fas fa-trash"></i> Limpiar Todos los Datos
                    </button>
                    <button class="btn btn-secondary" id="backup-data">
                        <i class="fas fa-save"></i> Crear Copia de Seguridad
                    </button>
                    <button class="btn btn-secondary" id="import-data">
                        <i class="fas fa-upload"></i> Importar Datos
                    </button>
                    <button class="btn btn-accent" id="generate-report">
                        <i class="fas fa-chart-line"></i> Generar Informe
                    </button>
                </div>
                
                <div class="stats-grid" style="margin-top: 2rem;">
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-links">0</div>
                        <div class="stat-label">Total de Recursos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-storage-used">0 KB</div>
                        <div class="stat-label">Almacenamiento Usado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-avg-rating">0.0</div>
                        <div class="stat-label">Valoraci√≥n Promedio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-favorites">0</div>
                        <div class="stat-label">Recursos Favoritos</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Plataforma Educativa Segura | Geolocalizaci√≥n Avanzada con M√∫ltiples APIs | Desarrollado con HTML5, CSS3 & JavaScript</p>
    </footer>

    <!-- Modal de confirmaci√≥n -->
    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <h3 id="modal-title">Confirmar Acci√≥n</h3>
            <p id="modal-message">¬øEst√°s seguro de que deseas realizar esta acci√≥n?</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="modal-cancel">Cancelar</button>
                <button class="btn btn-danger" id="modal-confirm">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // ========================
        // === C√ìDIGO JAVASCRIPT ===
        // ========================
        
        // Array para almacenar todos los enlaces (simulaci√≥n de base de datos)
        let allLinks = JSON.parse(localStorage.getItem('educationalLinks')) || [];
        
        // Inicializar estad√≠sticas y cargar enlaces al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            initTabs();
            initTheme();
            updateStats();
            displayAllLinks();
            setupAdvancedFilters();
            initCharts();
            setupEventListeners();
            
            // Configurar b√∫squeda y filtros
            document.getElementById('search-input').addEventListener('input', filterLinks);
            document.getElementById('category-filter').addEventListener('change', filterLinks);
        });
        
        // ===========================
        // === FUNCIONALIDAD DE TABS ===
        // ===========================
        
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Desactivar todas las pesta√±as
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Activar la pesta√±a seleccionada
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Si es la pesta√±a de estad√≠sticas, actualizar gr√°ficos
                    if (tabId === 'analytics') {
                        updateCharts();
                    } else if (tabId === 'admin') {
                        updateAdminStats();
                    }
                });
            });
        }
        
        // ===========================
        // === TEMA OSCURO/CLARO ===
        // ===========================
        
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            // Aplicar tema guardado
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // Configurar evento del bot√≥n
            themeToggle.addEventListener('click', function() {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });
        }
        
        function updateThemeIcon(theme) {
            const icon = document.querySelector('#theme-toggle i');
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
        }
        
        // ===========================
        // === FILTROS AVANZADOS ===
        // ===========================
        
        function setupAdvancedFilters() {
            // Configurar filtro de fecha personalizada
            document.getElementById('date-filter').addEventListener('change', function() {
                const customRange = document.getElementById('custom-date-range');
                if (this.value === 'custom') {
                    customRange.style.display = 'grid';
                } else {
                    customRange.style.display = 'none';
                }
                filterLinks();
            });
            
            // Configurar filtros adicionales
            document.getElementById('country-filter').addEventListener('change', filterLinks);
            document.getElementById('accuracy-filter').addEventListener('change', filterLinks);
            document.getElementById('sort-by').addEventListener('change', filterLinks);
            document.getElementById('start-date').addEventListener('change', filterLinks);
            document.getElementById('end-date').addEventListener('change', filterLinks);
            document.getElementById('favorites-filter').addEventListener('change', filterLinks);
            
            // Llenar el filtro de pa√≠ses
            updateCountryFilter();
        }
        
        function updateCountryFilter() {
            const countryFilter = document.getElementById('country-filter');
            const countries = [...new Set(allLinks.map(link => link.country))].sort();
            
            // Limpiar opciones existentes (excepto la primera)
            while (countryFilter.children.length > 1) {
                countryFilter.removeChild(countryFilter.lastChild);
            }
            
            // Agregar pa√≠ses
            countries.forEach(country => {
                if (country && country !== 'Pa√≠s no detectado') {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countryFilter.appendChild(option);
                }
            });
        }
        
        // ===========================
        // === GR√ÅFICOS AVANZADOS ===
        // ===========================
        
        let categoryChart, countryChart;
        
        function initCharts() {
            const categoryCtx = document.getElementById('category-chart').getContext('2d');
            const countryCtx = document.getElementById('country-chart').getContext('2d');
            
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Material de Estudio', 'Video Tutoriales', 'Ejercicios y Pr√°cticas', 'Ciencia y Tecnolog√≠a', 'Otros Recursos'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#2563eb',
                            '#10b981',
                            '#f59e0b',
                            '#8b5cf6',
                            '#6b7280'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Distribuci√≥n por Categor√≠a'
                        }
                    }
                }
            });
            
            countryChart = new Chart(countryCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Recursos por Pa√≠s',
                        data: [],
                        backgroundColor: '#2563eb'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Recursos por Pa√≠s'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function updateCharts() {
            // Actualizar gr√°fico de categor√≠as
            const categoryCounts = [0, 0, 0, 0, 0];
            allLinks.forEach(link => {
                if (link.categoria >= '1' && link.categoria <= '5') {
                    categoryCounts[parseInt(link.categoria) - 1]++;
                }
            });
            
            categoryChart.data.datasets[0].data = categoryCounts;
            categoryChart.update();
            
            // Actualizar gr√°fico de pa√≠ses
            const countryCounts = {};
            allLinks.forEach(link => {
                if (link.country && link.country !== 'Pa√≠s no detectado') {
                    countryCounts[link.country] = (countryCounts[link.country] || 0) + 1;
                }
            });
            
            // Ordenar pa√≠ses por cantidad (top 10)
            const sortedCountries = Object.entries(countryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            countryChart.data.labels = sortedCountries.map(item => item[0]);
            countryChart.data.datasets[0].data = sortedCountries.map(item => item[1]);
            countryChart.update();
            
            // Actualizar estad√≠sticas avanzadas
            updateAdvancedStats();
        }
        
        function updateAdvancedStats() {
            // Pa√≠s m√°s activo
            const countryCounts = {};
            allLinks.forEach(link => {
                if (link.country && link.country !== 'Pa√≠s no detectado') {
                    countryCounts[link.country] = (countryCounts[link.country] || 0) + 1;
                }
            });
            
            const mostActiveCountry = Object.entries(countryCounts)
                .sort((a, b) => b[1] - a[1])[0];
            
            document.getElementById('most-active-country').textContent = 
                mostActiveCountry ? `${mostActiveCountry[0]} (${mostActiveCountry[1]})` : '-';
            
            // Hora pico de actividad
            const hourCounts = {};
            allLinks.forEach(link => {
                const hour = new Date(link.timestamp).getHours();
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });
            
            const peakHour = Object.entries(hourCounts)
                .sort((a, b) => b[1] - a[1])[0];
            
            document.getElementById('peak-activity-time').textContent = 
                peakHour ? `${peakHour[0]}:00 - ${peakHour[0]}:59 (${peakHour[1]})` : '-';
            
            // D√≠a m√°s activo
            const dayCounts = {};
            allLinks.forEach(link => {
                const day = new Date(link.timestamp).toLocaleDateString('es-ES', { weekday: 'long' });
                dayCounts[day] = (dayCounts[day] || 0) + 1;
            });
            
            const mostActiveDay = Object.entries(dayCounts)
                .sort((a, b) => b[1] - a[1])[0];
            
            document.getElementById('most-active-day').textContent = 
                mostActiveDay ? `${mostActiveDay[0]} (${mostActiveDay[1]})` : '-';
            
            // Categor√≠a m√°s popular
            const categoryCounts = {};
            allLinks.forEach(link => {
                const categoryNames = {
                    '1': 'Material de Estudio',
                    '2': 'Video Tutoriales',
                    '3': 'Ejercicios y Pr√°cticas',
                    '4': 'Ciencia y Tecnolog√≠a',
                    '5': 'Otros Recursos'
                };
                const categoryName = categoryNames[link.categoria];
                categoryCounts[categoryName] = (categoryCounts[categoryName] || 0) + 1;
            });
            
            const mostPopularCategory = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])[0];
            
            document.getElementById('most-popular-category').textContent = 
                mostPopularCategory ? `${mostPopularCategory[0]} (${mostPopularCategory[1]})` : '-';
        }
        
        // ===========================
        // === GESTI√ìN DE ENLACES ===
        // ===========================
        
        // Manejador del formulario
        document.getElementById('link-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // Capturar los datos del formulario
            const nombre = document.getElementById('nombre').value.trim();
            const linkURL = document.getElementById('link-url').value.trim();
            const categoria = document.getElementById('categoria').value;
            const descripcion = document.getElementById('descripcion').value.trim();

            // Validaciones b√°sicas
            if (!nombre || !linkURL || !categoria) {
                alert('Por favor, completa todos los campos obligatorios.');
                return;
            }

            // Ocultar el mensaje inicial
            document.getElementById('no-links-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';

            // Obtener informaci√≥n de geolocalizaci√≥n avanzada
            getAdvancedGeolocation(nombre, linkURL, categoria, descripcion);

            // Limpiar el formulario
            this.reset();
        });

        // ===================================
        // === FUNCIONES DE GEOLOCALIZACI√ìN ===
        // ===================================

        /**
         * Sistema avanzado de geolocalizaci√≥n con simulaci√≥n de doble API y fallback.
         */
        async function getAdvancedGeolocation(nombre, url, categoria, descripcion) {
            const container = document.getElementById('links-container');
            
            // Mostrar indicador de carga
            const loadingIndicator = document.createElement('div');
            loadingIndicator.classList.add('loading');
            loadingIndicator.innerHTML = '<div class="spinner"></div><p>Detectando ubicaci√≥n precisa con sistema avanzado</p>';
            container.prepend(loadingIndicator);
            
            let finalLocationData = {
                ip: 'No disponible',
                city: 'Ciudad no detectada',
                region: 'Regi√≥n no detectada', 
                country: 'Pa√≠s no detectado',
                district: 'Barrio no detectado',
                network: 'Proveedor no identificado',
                timezone: 'Zona horaria no detectada',
                accuracy: 'low',
                loc: null // Lat,Long
            };
            
            try {
                // 1. Intentar con la API principal (ipapi.co - simulaci√≥n)
                const primaryResponse = await fetchWithTimeout('https://ipapi.co/json/', 5000);
                const primaryData = await primaryResponse.json();
                
                finalLocationData = processLocationData(primaryData, 'ipapi');
                
                // 2. Si faltan datos cr√≠ticos, intentar con API secundaria (ipinfo.io - simulaci√≥n)
                if (finalLocationData.accuracy === 'low') {
                    const secondaryResponse = await fetchWithTimeout('https://ipinfo.io/json?token=demo', 5000); // Usando token de demo
                    const backupData = await secondaryResponse.json();
                    
                    // Combinar datos
                    finalLocationData = finalLocationData.combineWithBackup(backupData);
                }
                
                // 3. Intento de geolocalizaci√≥n del navegador para alta precisi√≥n (solo funciona en HTTPs y con permiso)
                try {
                    const geoPromise = new Promise((resolve, reject) => {
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(position => {
                                // Esto dar√≠a una precisi√≥n muy alta (GPS o WiFi/Cell)
                                const lat = position.coords.latitude;
                                const lon = position.coords.longitude;
                                finalLocationData.loc = `${lat},${lon}`;
                                finalLocationData.accuracy = 'high';
                                resolve();
                            }, error => {
                                // Manejo de error de permiso o timeout de GPS
                                console.warn(`Error de Geolocalizaci√≥n de navegador: ${error.message}`);
                                resolve(); // Contin√∫a sin datos de GPS
                            }, { timeout: 3000, enableHighAccuracy: true });
                        } else {
                            resolve(); // Navegador no soporta
                        }
                    });
                    await geoPromise;
                } catch (e) {
                    console.error("Error al intentar geolocalizaci√≥n del navegador:", e);
                }

            } catch (error) {
                console.error('Fallo total en la geolocalizaci√≥n avanzada:', error);
                // Los datos de fallback predeterminados ya est√°n en finalLocationData
            } finally {
                // Eliminar indicador de carga
                loadingIndicator.remove();
                
                // Crear objeto con toda la informaci√≥n
                const linkData = {
                    id: Date.now(),
                    nombre,
                    url,
                    categoria,
                    descripcion,
                    ...finalLocationData.getFinalData(),
                    timestamp: new Date().toISOString(),
                    rating: 0,
                    favorites: 0,
                    isFavorite: false
                };
                
                // Guardar en localStorage
                allLinks.unshift(linkData);
                localStorage.setItem('educationalLinks', JSON.stringify(allLinks));
                
                // Mostrar el registro en la web
                displayLinkEntry(linkData);
                
                // Actualizar estad√≠sticas
                updateStats();
                updateCharts();
                updateCountryFilter();
                updateAdminStats();
                
                // Mostrar mensaje de √©xito
                showSuccessMessage();
                
                // Cambiar a la pesta√±a de recursos
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('.tab[data-tab="resources"]').classList.add('active');
                document.getElementById('resources').classList.add('active');
            }
        }

        /**
         * Funci√≥n para fetch con timeout (para simular fallos de red)
         */
        function fetchWithTimeout(url, timeout = 5000) {
            return Promise.race([
                fetch(url),
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Timeout de API de Geolocalizaci√≥n')), timeout)
                )
            ]);
        }

        /**
         * Procesador de datos de ubicaci√≥n gen√©rico.
         */
        function processLocationData(data, source) {
            const result = {
                ip: data.ip || 'No detectado',
                city: '',
                region: '',
                country: '',
                district: '',
                network: '',
                timezone: '',
                accuracy: 'medium', // Valor por defecto
                loc: null
            };
            
            if (source === 'ipapi') {
                result.city = data.city || 'Ciudad no detectada';
                result.region = data.region || 'Regi√≥n no detectada';
                result.country = data.country_name || 'Pa√≠s no detectado';
                result.district = detectDistrict(data);
                result.network = data.org || data.asn || 'Proveedor no identificado';
                result.timezone = data.timezone || 'Zona horaria no detectada';
                result.loc = (data.latitude && data.longitude) ? 
                    `${data.latitude},${data.longitude}` : null;
                result.accuracy = determineAccuracy(data);
            }
            // Aqu√≠ se pueden a√±adir otros casos para diferentes APIs iniciales
            
            // M√©todo para combinar con datos de respaldo
            result.combineWithBackup = function(backupData) {
                // ipinfo.io usa 'region' y 'city'
                if (!this.city || this.city === 'Ciudad no detectada') {
                    this.city = backupData.city || this.city;
                }
                if (!this.region || this.region === 'Regi√≥n no detectada') {
                    this.region = backupData.region || this.region;
                }
                if (!this.country || this.country === 'Pa√≠s no detectado') {
                    this.country = backupData.country || this.country;
                }
                if (!this.district || this.district === 'Barrio no detectado') {
                    this.district = detectDistrict(backupData);
                }
                if (!this.network || this.network === 'Proveedor no identificado') {
                     this.network = backupData.org || this.network;
                }
                if (!this.loc && backupData.loc) {
                    this.loc = backupData.loc;
                    this.accuracy = determineAccuracy({latitude: backupData.loc.split(',')[0], longitude: backupData.loc.split(',')[1], city: this.city, region: this.region});
                }
                return this;
            };
            
            // Obtener datos finales
            result.getFinalData = function() {
                return {
                    ip: this.ip,
                    city: this.city,
                    region: this.region,
                    country: this.country,
                    district: this.district,
                    network: this.network,
                    timezone: this.timezone,
                    accuracy: this.accuracy,
                    loc: this.loc
                };
            };
            
            return result;
        }

        /**
         * Detectar barrio/distrito (simulado, en realidad requiere APIs m√°s avanzadas o bases de datos internas)
         */
        function detectDistrict(data) {
            if (data.city) {
                return `Zona Metropolitana de ${data.city}`;
            } else if (data.region) {
                return `√Årea de ${data.region}`;
            }
            return 'Barrio no detectado';
        }

        /**
         * Determinar precisi√≥n de la ubicaci√≥n
         */
        function determineAccuracy(data) {
            if (data.loc && data.loc.includes(',') && data.city) {
                return 'high'; // Lat/Lon y Ciudad -> Alta
            } else if (data.city && data.region) {
                return 'medium'; // Ciudad y Regi√≥n -> Media
            } else if (data.country) {
                return 'low'; // Solo Pa√≠s -> Baja
            }
            return 'low';
        }

        // =================================
        // === FUNCIONES DE VISUALIZACI√ìN ===
        // =================================
        
        /**
         * Muestra el mensaje de √©xito de forma temporal.
         */
        function showSuccessMessage() {
            const successDiv = document.getElementById('success-message');
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        /**
         * Muestra una entrada de enlace en la interfaz
         */
        function displayLinkEntry(linkData) {
            const container = document.getElementById('links-container');
            const noLinksMessage = document.getElementById('no-links-message');
            
            if (noLinksMessage) {
                noLinksMessage.style.display = 'none'; // Asegura que el mensaje de carga se oculta
            }
            
            // Nombres de categor√≠as
            const categoryNames = {
                '1': 'üìö Material de Estudio',
                '2': 'üé• Video Tutoriales', 
                '3': 'üìù Ejercicios y Pr√°cticas',
                '4': 'üî¨ Ciencia y Tecnolog√≠a',
                '5': 'üåê Otros Recursos'
            };
            
            // Formatear fecha
            const date = new Date(linkData.timestamp);
            const formattedDate = date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            // Determinar estado de detecci√≥n y texto de precisi√≥n
            let detectionStatus, detectionText, accuracyWidth;
            if (linkData.accuracy === 'high') {
                detectionStatus = 'detected';
                detectionText = 'Completa';
                accuracyWidth = '95%';
            } else if (linkData.accuracy === 'medium') {
                detectionStatus = 'detected';
                detectionText = 'Media';
                accuracyWidth = '65%';
            } else {
                detectionStatus = 'not-detected';
                detectionText = 'Limitada';
                accuracyWidth = '30%';
            }

            // Generar estrellas de valoraci√≥n
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                const activeClass = i <= linkData.rating ? 'active' : '';
                starsHTML += `<span class="star ${activeClass}" data-rating="${i}" data-id="${linkData.id}">‚òÖ</span>`;
            }

            const entryDiv = document.createElement('div');
            entryDiv.classList.add('link-entry', 'fade-in');
            entryDiv.dataset.id = linkData.id;
            entryDiv.dataset.category = linkData.categoria;
            entryDiv.dataset.country = linkData.country;
            entryDiv.dataset.accuracy = linkData.accuracy;
            entryDiv.dataset.timestamp = linkData.timestamp;
            entryDiv.dataset.rating = linkData.rating;
            entryDiv.dataset.favorite = linkData.isFavorite;
            entryDiv.dataset.search = `${linkData.nombre.toLowerCase()} ${linkData.descripcion.toLowerCase()} ${linkData.country.toLowerCase()} ${linkData.city.toLowerCase()} ${categoryNames[linkData.categoria].toLowerCase()}`;

            entryDiv.innerHTML = `
                <div class="entry-header">
                    <div class="user-name">
                        <i class="fas fa-user-circle"></i> ${linkData.nombre}
                    </div>
                    <span class="category-tag">${categoryNames[linkData.categoria]}</span>
                </div>
                
                <div class="link-content">
                    <p>
                        <i class="fas fa-link"></i>
                        <strong>Recurso:</strong> 
                        <a href="${linkData.url}" target="_blank" rel="noopener noreferrer">${linkData.url}</a>
                    </p>
                    <p>
                        <i class="fas fa-align-left"></i>
                        <strong>Descripci√≥n:</strong> 
                        ${linkData.descripcion || '<em>Sin descripci√≥n adicional</em>'}
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn favorite-btn ${linkData.isFavorite ? 'active' : ''}" data-id="${linkData.id}">
                        <i class="fas fa-heart"></i>
                    </button>
                    <button class="action-btn share-btn" data-id="${linkData.id}">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
                
                <div class="rating">
                    ${starsHTML}
                </div>
                
                <button class="toggle-details" data-target="details-${linkData.id}">
                    <i class="fas fa-map-marked-alt"></i> Mostrar Detalles Avanzados de Geolocalizaci√≥n
                </button>

                <div id="details-${linkData.id}" class="details-content">
                    
                    <h3><i class="fas fa-bullseye"></i> Datos de Ubicaci√≥n y Precisi√≥n</h3>
                    <div class="ip-info">
                        <i class="fas fa-network-wired"></i>
                        <strong>IP de Registro:</strong> <code>${linkData.ip}</code>
                        <span class="detection-status ${detectionStatus}">${detectionText}</span>
                        <div class="accuracy-indicator">
                            <span>Precisi√≥n Estimada:</span>
                            <div class="accuracy-bar">
                                <div class="accuracy-level" style="width: ${accuracyWidth}; background-color: ${linkData.accuracy === 'high' ? '#10b981' : linkData.accuracy === 'medium' ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span style="font-weight: bold;">(${detectionText})</span>
                        </div>
                    </div>
                    
                    <div class="geo-grid">
                        <div class="geo-card">
                            <h4><i class="fas fa-globe"></i> Pa√≠s/C√≥digo</h4>
                            <p>${linkData.country}</p>
                        </div>
                        
                        <div class="geo-card">
                            <h4><i class="fas fa-map"></i> Regi√≥n/Estado</h4>
                            <p>${linkData.region}</p>
                        </div>
                        
                        <div class="geo-card">
                            <h4><i class="fas fa-city"></i> Ciudad/Localidad</h4>
                            <p>${linkData.city}</p>
                        </div>
                        
                        <div class="geo-card">
                            <h4><i class="fas fa-street-view"></i> Proveedor de Red</h4>
                            <p>${linkData.network}</p>
                        </div>

                        <div class="geo-card">
                            <h4><i class="fas fa-clock"></i> Zona Horaria</h4>
                            <p>${linkData.timezone}</p>
                        </div>
                        
                        <div class="geo-card">
                            <h4><i class="fas fa-location-arrow"></i> Coordenadas (Lat,Lon)</h4>
                            <p>${linkData.loc || 'No disponibles'}</p>
                        </div>
                    </div>
                    
                    <div class="map-container" id="map-${linkData.id}"></div>

                </div>
                <p class="timestamp">
                    <i class="far fa-calendar-alt"></i> Registrado el ${formattedDate}
                </p>
            `;
            
            // Insertar el nuevo elemento al principio de la lista
            const firstLink = container.querySelector('.link-entry');
            if (firstLink) {
                container.insertBefore(entryDiv, firstLink);
            } else {
                container.appendChild(entryDiv);
            }
            
            // Inicializar el mapa de Leaflet
            if (linkData.loc) {
                initMap(linkData.id, linkData.loc, linkData.city, linkData.accuracy);
            }
            
            // Agregar manejador de evento para el toggle
            entryDiv.querySelector('.toggle-details').addEventListener('click', function() {
                const targetId = this.dataset.target;
                const detailsContent = document.getElementById(targetId);
                const isShown = detailsContent.classList.contains('show');

                if (isShown) {
                    detailsContent.classList.remove('show');
                    this.innerHTML = '<i class="fas fa-map-marked-alt"></i> Mostrar Detalles Avanzados de Geolocalizaci√≥n';
                } else {
                    detailsContent.classList.add('show');
                    this.innerHTML = '<i class="fas fa-times-circle"></i> Ocultar Detalles';
                    // Recargar el mapa si se muestra (soluciona problemas de tiles rotos)
                    if (linkData.loc) {
                        const mapId = `map-${linkData.id}`;
                        // Asegura que el mapa se inicialice solo si es necesario (puede estar ya inicializado)
                        if (!document.getElementById(mapId)._leaflet_id) {
                            initMap(linkData.id, linkData.loc, linkData.city, linkData.accuracy);
                        } else {
                            // Si ya est√° inicializado, invalidamos el tama√±o para que se ajuste al div visible
                             setTimeout(() => window.maps[mapId].invalidateSize(), 50);
                        }
                    }
                }
            });
        }
        
        /**
         * Inicializa el mapa Leaflet.
         */
        window.maps = window.maps || {}; // Objeto global para almacenar instancias de mapas
        function initMap(id, loc, city, accuracy) {
            const [lat, lon] = loc.split(',').map(Number);
            const mapId = `map-${id}`;
            let zoomLevel = 10; // Zoom por defecto

            if (accuracy === 'high') {
                zoomLevel = 14; // M√°s cerca para alta precisi√≥n
            } else if (accuracy === 'medium') {
                zoomLevel = 10; // Nivel de ciudad
            } else {
                zoomLevel = 6; // Nivel de regi√≥n/pa√≠s
            }

            // Destruir mapa anterior si existe para evitar duplicados
            if (window.maps[mapId]) {
                window.maps[mapId].remove();
            }

            // Inicializar el mapa
            const map = L.map(mapId).setView([lat, lon], zoomLevel);
            window.maps[mapId] = map;

            // A√±adir capa de tiles (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // A√±adir un marcador
            L.marker([lat, lon]).addTo(map)
                .bindPopup(`Ubicaci√≥n de Registro: **${city}**<br>Precisi√≥n: **${accuracy}**`)
                .openPopup();
        }

        /**
         * Muestra todos los enlaces cargados
         */
        function displayAllLinks() {
            const container = document.getElementById('links-container');
            const noLinksMessage = document.getElementById('no-links-message');
            
            // Limpiar contenedor antes de mostrar
            Array.from(container.children).forEach(child => {
                if (child.classList.contains('link-entry')) {
                    child.remove();
                }
            });

            if (allLinks.length === 0) {
                noLinksMessage.textContent = 'No hay recursos compartidos todav√≠a. ¬°S√© el primero en a√±adir uno! üòä';
                noLinksMessage.classList.remove('loading');
                noLinksMessage.style.display = 'block';
            } else {
                noLinksMessage.style.display = 'none';
                allLinks.forEach(link => {
                    displayLinkEntry(link);
                });
            }
        }
        
        /**
         * Filtra y busca enlaces
         */
        function filterLinks() {
            const searchTerms = document.getElementById('search-input').value.toLowerCase().trim();
            const categoryFilter = document.getElementById('category-filter').value;
            const countryFilter = document.getElementById('country-filter').value;
            const accuracyFilter = document.getElementById('accuracy-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const sortBy = document.getElementById('sort-by').value;
            const favoritesFilter = document.getElementById('favorites-filter').value;
            
            const linkEntries = document.querySelectorAll('.link-entry');
            let visibleCount = 0;
            
            linkEntries.forEach(entry => {
                const isCategoryMatch = categoryFilter === '' || entry.dataset.category === categoryFilter;
                const isCountryMatch = countryFilter === '' || entry.dataset.country === countryFilter;
                const isAccuracyMatch = accuracyFilter === '' || entry.dataset.accuracy === accuracyFilter;
                const isSearchMatch = entry.dataset.search.includes(searchTerms);
                const isFavoriteMatch = favoritesFilter === 'all' || 
                    (favoritesFilter === 'favorites' && entry.dataset.favorite === 'true');
                
                // Filtro por fecha
                let isDateMatch = true;
                if (dateFilter !== '') {
                    const entryDate = new Date(entry.dataset.timestamp);
                    const today = new Date();
                    
                    if (dateFilter === 'today') {
                        isDateMatch = entryDate.toDateString() === today.toDateString();
                    } else if (dateFilter === 'week') {
                        const weekAgo = new Date(today);
                        weekAgo.setDate(today.getDate() - 7);
                        isDateMatch = entryDate >= weekAgo;
                    } else if (dateFilter === 'month') {
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(today.getMonth() - 1);
                        isDateMatch = entryDate >= monthAgo;
                    } else if (dateFilter === 'custom' && startDate && endDate) {
                        const start = new Date(startDate);
                        const end = new Date(endDate);
                        end.setHours(23, 59, 59, 999); // Fin del d√≠a
                        isDateMatch = entryDate >= start && entryDate <= end;
                    }
                }

                if (isCategoryMatch && isCountryMatch && isAccuracyMatch && isSearchMatch && isDateMatch && isFavoriteMatch) {
                    entry.style.display = 'block';
                    visibleCount++;
                } else {
                    entry.style.display = 'none';
                }
            });

            // Ordenar elementos visibles
            const container = document.getElementById('links-container');
            const visibleEntries = Array.from(container.querySelectorAll('.link-entry'))
                .filter(entry => entry.style.display !== 'none');
                
            // Ordenar seg√∫n criterio seleccionado
            visibleEntries.sort((a, b) => {
                if (sortBy === 'newest') {
                    return new Date(b.dataset.timestamp) - new Date(a.dataset.timestamp);
                } else if (sortBy === 'oldest') {
                    return new Date(a.dataset.timestamp) - new Date(b.dataset.timestamp);
                } else if (sortBy === 'name') {
                    const nameA = a.querySelector('.user-name').textContent.toLowerCase();
                    const nameB = b.querySelector('.user-name').textContent.toLowerCase();
                    return nameA.localeCompare(nameB);
                } else if (sortBy === 'country') {
                    const countryA = a.dataset.country || '';
                    const countryB = b.dataset.country || '';
                    return countryA.localeCompare(countryB);
                } else if (sortBy === 'rating') {
                    const ratingA = parseInt(a.dataset.rating) || 0;
                    const ratingB = parseInt(b.dataset.rating) || 0;
                    return ratingB - ratingA;
                }
                return 0;
            });
            
            // Reorganizar elementos en el DOM
            visibleEntries.forEach(entry => container.appendChild(entry));

            // Mostrar mensaje si no hay resultados de b√∫squeda/filtro
            let noResultsMessage = document.getElementById('no-results-filter-message');
            if (!noResultsMessage) {
                noResultsMessage = document.createElement('p');
                noResultsMessage.id = 'no-results-filter-message';
                noResultsMessage.style.cssText = 'text-align: center; padding: 2rem; color: #dc3545; font-weight: bold; font-style: italic;';
                container.appendChild(noResultsMessage);
            }

            if (visibleCount === 0 && allLinks.length > 0) {
                noResultsMessage.textContent = 'üòî No se encontraron recursos que coincidan con los filtros aplicados.';
                noResultsMessage.style.display = 'block';
            } else {
                noResultsMessage.style.display = 'none';
            }
        }

        /**
         * Actualiza los cuadros de estad√≠sticas
         */
        function updateStats() {
            const totalLinks = allLinks.length;
            const countries = new Set(allLinks.map(link => link.country));
            const uniqueCountries = countries.size;
            
            const today = new Date().toISOString().split('T')[0];
            const todayLinks = allLinks.filter(link => link.timestamp.startsWith(today)).length;
            
            const highAccuracyLinks = allLinks.filter(link => link.accuracy === 'high').length;
            const detectionRate = totalLinks > 0 ? ((highAccuracyLinks / totalLinks) * 100).toFixed(1) : 0;

            document.getElementById('total-links').textContent = totalLinks;
            document.getElementById('unique-countries').textContent = uniqueCountries;
            document.getElementById('today-links').textContent = todayLinks;
            document.getElementById('detection-rate').textContent = `${detectionRate}%`;
        }

        // ===========================
        // === FUNCIONALIDADES NUEVAS ===
        // ===========================
        
        function setupEventListeners() {
            // Eventos para favoritos
            document.addEventListener('click', function(e) {
                if (e.target.closest('.favorite-btn')) {
                    const btn = e.target.closest('.favorite-btn');
                    const id = parseInt(btn.dataset.id);
                    toggleFavorite(id, btn);
                }
                
                // Eventos para valoraci√≥n con estrellas
                if (e.target.classList.contains('star')) {
                    const id = parseInt(e.target.dataset.id);
                    const rating = parseInt(e.target.dataset.rating);
                    rateResource(id, rating);
                }
                
                // Eventos para compartir
                if (e.target.closest('.share-btn')) {
                    const btn = e.target.closest('.share-btn');
                    const id = parseInt(btn.dataset.id);
                    shareResource(id);
                }
            });
            
            // Eventos para exportaci√≥n
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('export-csv').addEventListener('click', exportCSV);
            document.getElementById('export-pdf').addEventListener('click', exportPDF);
            
            // Eventos para administraci√≥n
            document.getElementById('clear-all-data').addEventListener('click', confirmClearData);
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('import-data').addEventListener('click', importData);
            document.getElementById('generate-report').addEventListener('click', generateReport);
            
            // Eventos para el modal
            document.getElementById('modal-cancel').addEventListener('click', closeModal);
            document.getElementById('modal-confirm').addEventListener('click', executeModalAction);
        }
        
        function toggleFavorite(id, btn) {
            const linkIndex = allLinks.findIndex(link => link.id === id);
            if (linkIndex !== -1) {
                allLinks[linkIndex].isFavorite = !allLinks[linkIndex].isFavorite;
                localStorage.setItem('educationalLinks', JSON.stringify(allLinks));
                
                // Actualizar UI
                btn.classList.toggle('active');
                const entry = document.querySelector(`.link-entry[data-id="${id}"]`);
                if (entry) {
                    entry.dataset.favorite = allLinks[linkIndex].isFavorite;
                }
                
                // Actualizar estad√≠sticas de administraci√≥n
                updateAdminStats();
            }
        }
        
        function rateResource(id, rating) {
            const linkIndex = allLinks.findIndex(link => link.id === id);
            if (linkIndex !== -1) {
                allLinks[linkIndex].rating = rating;
                localStorage.setItem('educationalLinks', JSON.stringify(allLinks));
                
                // Actualizar UI
                const entry = document.querySelector(`.link-entry[data-id="${id}"]`);
                if (entry) {
                    entry.dataset.rating = rating;
                    const stars = entry.querySelectorAll('.star');
                    stars.forEach((star, index) => {
                        if (index < rating) {
                            star.classList.add('active');
                        } else {
                            star.classList.remove('active');
                        }
                    });
                }
                
                // Actualizar estad√≠sticas de administraci√≥n
                updateAdminStats();
            }
        }
        
        function shareResource(id) {
            const link = allLinks.find(link => link.id === id);
            if (link) {
                if (navigator.share) {
                    navigator.share({
                        title: `Recurso educativo: ${link.nombre}`,
                        text: link.descripcion,
                        url: link.url
                    });
                } else {
                    // Fallback para navegadores que no soportan Web Share API
                    const shareUrl = `${window.location.origin}${window.location.pathname}?resource=${id}`;
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        alert('Enlace copiado al portapapeles');
                    });
                }
            }
        }
        
        function exportJSON() {
            const dataStr = JSON.stringify(allLinks, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            downloadFile(dataBlob, 'recursos-educativos.json');
        }
        
        function exportCSV() {
            let csvContent = "Nombre,Categor√≠a,URL,Descripci√≥n,Pa√≠s,Ciudad,Regi√≥n,IP,Proveedor,Precisi√≥n,Valoraci√≥n,Favorito,Fecha\n";
            
            allLinks.forEach(link => {
                const row = [
                    `"${link.nombre}"`,
                    `"${getCategoryName(link.categoria)}"`,
                    `"${link.url}"`,
                    `"${link.descripcion || ''}"`,
                    `"${link.country}"`,
                    `"${link.city}"`,
                    `"${link.region}"`,
                    `"${link.ip}"`,
                    `"${link.network}"`,
                    `"${link.accuracy}"`,
                    link.rating,
                    link.isFavorite ? 'S√≠' : 'No',
                    `"${new Date(link.timestamp).toLocaleDateString('es-ES')}"`
                ];
                csvContent += row.join(',') + '\n';
            });
            
            const dataBlob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
            downloadFile(dataBlob, 'recursos-educativos.csv');
        }
        
        function exportPDF() {
            // En una implementaci√≥n real, aqu√≠ se usar√≠a una librer√≠a como jsPDF
            alert('La exportaci√≥n a PDF requiere una librer√≠a adicional. En esta demo, se simula la funcionalidad.');
            
            // Simulaci√≥n de exportaci√≥n
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Recursos Educativos - Reporte</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #2563eb; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>
                        <h1>Recursos Educativos Compartidos</h1>
                        <p>Total de recursos: ${allLinks.length}</p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Categor√≠a</th>
                                    <th>URL</th>
                                    <th>Pa√≠s</th>
                                    <th>Fecha</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allLinks.map(link => `
                                    <tr>
                                        <td>${link.nombre}</td>
                                        <td>${getCategoryName(link.categoria)}</td>
                                        <td>${link.url}</td>
                                        <td>${link.country}</td>
                                        <td>${new Date(link.timestamp).toLocaleDateString('es-ES')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function getCategoryName(categoryId) {
            const categoryNames = {
                '1': 'Material de Estudio',
                '2': 'Video Tutoriales',
                '3': 'Ejercicios y Pr√°cticas',
                '4': 'Ciencia y Tecnolog√≠a',
                '5': 'Otros Recursos'
            };
            return categoryNames[categoryId] || 'Desconocida';
        }
        
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function confirmClearData() {
            showModal(
                'Eliminar todos los datos',
                '¬øEst√°s seguro de que deseas eliminar todos los recursos compartidos? Esta acci√≥n no se puede deshacer.',
                clearAllData
            );
        }
        
        function clearAllData() {
            allLinks = [];
            localStorage.removeItem('educationalLinks');
            displayAllLinks();
            updateStats();
            updateCharts();
            updateAdminStats();
            closeModal();
        }
        
        function backupData() {
            const backup = {
                timestamp: new Date().toISOString(),
                data: allLinks
            };
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            downloadFile(dataBlob, `backup-recursos-${new Date().toISOString().split('T')[0]}.json`);
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const backup = JSON.parse(event.target.result);
                            if (backup.data && Array.isArray(backup.data)) {
                                allLinks = backup.data;
                                localStorage.setItem('educationalLinks', JSON.stringify(allLinks));
                                displayAllLinks();
                                updateStats();
                                updateCharts();
                                updateAdminStats();
                                updateCountryFilter();
                                alert('Datos importados correctamente');
                            } else {
                                alert('El archivo no contiene datos v√°lidos');
                            }
                        } catch (error) {
                            alert('Error al importar los datos: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function generateReport() {
            // En una implementaci√≥n real, esto generar√≠a un informe m√°s detallado
            const totalLinks = allLinks.length;
            const uniqueCountries = new Set(allLinks.map(link => link.country)).size;
            const avgRating = allLinks.reduce((sum, link) => sum + (link.rating || 0), 0) / totalLinks || 0;
            const favoritesCount = allLinks.filter(link => link.isFavorite).length;
            
            const report = `
                INFORME DE PLATAFORMA EDUCATIVA
                ===============================
                
                Total de recursos: ${totalLinks}
                Pa√≠ses participantes: ${uniqueCountries}
                Valoraci√≥n promedio: ${avgRating.toFixed(1)}/5
                Recursos favoritos: ${favoritesCount}
                
                Distribuci√≥n por categor√≠a:
                ${getCategoryDistribution()}
                
                Pa√≠ses m√°s activos:
                ${getTopCountries()}
                
                Fecha de generaci√≥n: ${new Date().toLocaleDateString('es-ES')}
            `;
            
            const dataBlob = new Blob([report], {type: 'text/plain'});
            downloadFile(dataBlob, `informe-plataforma-${new Date().toISOString().split('T')[0]}.txt`);
        }
        
        function getCategoryDistribution() {
            const categoryCounts = {
                '1': 0, '2': 0, '3': 0, '4': 0, '5': 0
            };
            
            allLinks.forEach(link => {
                if (categoryCounts.hasOwnProperty(link.categoria)) {
                    categoryCounts[link.categoria]++;
                }
            });
            
            return Object.entries(categoryCounts)
                .map(([id, count]) => `  - ${getCategoryName(id)}: ${count}`)
                .join('\n');
        }
        
        function getTopCountries() {
            const countryCounts = {};
            allLinks.forEach(link => {
                if (link.country && link.country !== 'Pa√≠s no detectado') {
                    countryCounts[link.country] = (countryCounts[link.country] || 0) + 1;
                }
            });
            
            return Object.entries(countryCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([country, count]) => `  - ${country}: ${count}`)
                .join('\n');
        }
        
        function updateAdminStats() {
            const totalLinks = allLinks.length;
            const storageUsed = new Blob([JSON.stringify(allLinks)]).size;
            const avgRating = allLinks.reduce((sum, link) => sum + (link.rating || 0), 0) / totalLinks || 0;
            const favoritesCount = allLinks.filter(link => link.isFavorite).length;
            
            document.getElementById('admin-total-links').textContent = totalLinks;
            document.getElementById('admin-storage-used').textContent = `${(storageUsed / 1024).toFixed(2)} KB`;
            document.getElementById('admin-avg-rating').textContent = avgRating.toFixed(1);
            document.getElementById('admin-favorites').textContent = favoritesCount;
        }
        
        // ===========================
        // === MODAL DE CONFIRMACI√ìN ===
        // ===========================
        
        let currentModalAction = null;
        
        function showModal(title, message, action) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            currentModalAction = action;
            document.getElementById('confirmation-modal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('confirmation-modal').style.display = 'none';
            currentModalAction = null;
        }
        
        function executeModalAction() {
            if (currentModalAction) {
                currentModalAction();
            }
        }
    </script>
</body>
</html>